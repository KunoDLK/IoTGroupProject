@model List<Bindicator.Models.SensorData>

<h2>Bin Locations</h2>

<div id="map" style="height: 500px; width: 100%;"></div>

<script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.js"></script>
<link href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css" rel="stylesheet" />

<script>
    const map = new atlas.Map('map', {
        center: [-1.3, 54.56], // Center on your area
        zoom: 13,
        authOptions: {
            authType: 'subscriptionKey',
            subscriptionKey: '6YZVxWqgi0evzdHfzLVwAVke8lgbHuNwhaMQKSv5TiDbpSZD1SCQJQQJ99BDAC5RqLJvjAgdAAAgAZMP1fVL'
        }
    });

    map.events.add('ready', () => {
        const bins = @Html.Raw(Json.Serialize(Model));

        bins.forEach(bin => {
            const marker = new atlas.HtmlMarker({
                position: [bin.longitude, bin.latitude],
                text: `${bin.binNumber}`,
                color: 'blue',
                popup: new atlas.Popup({
                    content: `<div style='padding: 4px'><strong>${bin.street}</strong><br/>Fill: ${bin.fillLevel.toFixed(0)}%</div>`
                })
            });

            map.markers.add(marker);
        });
    });
</script>
